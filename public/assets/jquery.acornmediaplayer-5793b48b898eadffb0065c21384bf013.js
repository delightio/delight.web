/*
 * Acorn Media Player - jQuery plugin 1.5
 *
 * Copyright (C) 2012 Ionut Cristian Colceriu
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * www.ghinda.net
 * contact@ghinda.net
 *
 */
function parseSrt(e){var t=e.replace(/\r+/g,"");t=t.replace(/^\s+|\s+$/g,""),t=t.replace(/<[a-zA-Z\/][^>]*>/g,"");var n=[],r=t.split("\n\n");for(var i=0;i<r.length;i+=1){var s="",o,u,a,f;s=r[i],f=s.split(/\n/);if(!f[0].match(/^\d+$/)||!f[1].match(/\d+:\d+:\d+/))continue;var l=f[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(!l)continue;u=parseInt(l[1],10)*60*60+parseInt(l[2],10)*60+parseInt(l[3],10)+parseInt(l[4],10)/1e3,a=parseInt(l[5],10)*60*60+parseInt(l[6],10)*60+parseInt(l[7],10)+parseInt(l[8],10)/1e3,o=f.slice(2).join("<br>"),n.push({start:u,end:a,content:o})}return n}(function(e){e.fn.acornMediaPlayer=function(t){function i(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}}var n={theme:"access",nativeSliders:!1,volumeSlider:"horizontal",captionsOn:!1};t=e.extend(n,t);var r=function(){var e=new Date;return e.getTime()},s=i?localStorage.getItem("acornvolume"):1;s||(s=1);var o=function(){var n={$self:e(this)},i,o,u,a,f={play:"Play",playTitle:"Start the playback",pause:"Pause",pauseTitle:"Pause the playback",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",fullscreenTitle:"Toggle fullscreen mode",volumeTitle:"Volume control",seekTitle:"Video seek control",captions:"Captions",captionsTitle:"Show captions",captionsChoose:"Choose caption",transcript:"Transcript",transcriptTitle:"Show transcript",rotateLeft90:"-90",rotateLeft90Title:"Rotate -90",rotate0:"0",rotate0Title:"Original",rotate90:"90",rotate90Title:"Rotate 90",rotate180:"180",rotate180Title:"Rotate 180"},l=e('<div class="acorn-player" role="application" style="width:90%;height:90%"></div>').addClass(t.theme);n.$self.attr("tabindex","0"),n.id=n.$self.attr("id"),n.id||(n.id="acorn"+r(),n.$self.attr("id",n.id));var c=n.$self.is("video")?'<button class="acorn-fullscreen-button" title="'+f.fullscreenTitle+'" aria-controls="'+n.id+'">'+f.fullscreen+"</button>":"",h='<div class="acorn-controls"><button class="acorn-play-button" title="'+f.playTitle+'" aria-controls="'+n.id+'">'+f.play+"</button>"+'<input type="range" class="acorn-seek-slider" title="'+f.seekTitle+'" value="0" min="0" max="150" step="0.1" aria-controls="'+n.id+'"/>'+'<span class="acorn-timer">00:00</span>'+'<span class="acorn-rotate-label">Rotate </span>'+'<button class="acorn-rotate-button" title="'+f.rotate180Title+'" id="rotate-180">'+f.rotate180+"</button>"+'<button class="acorn-rotate-button" title="'+f.rotate90Title+'" id="rotate-90">'+f.rotate90+"</button>"+'<button class="acorn-rotate-button" title="'+f.rotate0Title+'" id="rotate-0">'+f.rotate0+"</button>"+'<button class="acorn-rotate-button" title="'+f.rotateLeft90Title+'" id="rotate--90">'+f.rotateLeft90+"</button>"+"</div>",p='<div class="acorn-caption"></div>',d='<div class="acorn-transcript" role="region" aria-live="assertive"></div>';n.$self.wrap(l).after(h).after('<div class="loading-media"></div>'),n.$container=n.$self.parent(".acorn-player"),n.$controls=e(".acorn-controls",n.$container),n.$playBtn=e(".acorn-play-button",n.$container),n.$seek=e(".acorn-seek-slider",n.$container),n.$timer=e(".acorn-timer",n.$container),n.$volume=e(".acorn-volume-slider",n.$container),n.$volumeBtn=e(".acorn-volume-button",n.$container),n.$fullscreenBtn=e(".acorn-fullscreen-button",n.$container),n.$controls.after(p),n.$container.after(d),n.$transcript=n.$container.next(".acorn-transcript"),n.$transcriptBtn=e(".acorn-transcript-button",n.$container),n.$caption=e(".acorn-caption",n.$container),n.$captionBtn=e(".acorn-caption-button",n.$container),n.$captionSelector=e(".acorn-caption-selector",n.$container),n.$self.attr("data-width",n.$self.width()),n.$self.attr("data-height",n.$self.height());var v=function(e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),n=Math.floor(e-t*60)<10?"0"+Math.floor(e-t*60):Math.floor(e-t*60);return t+":"+n},m=function(){n.$self.prop("paused")?n.$self.trigger("play"):n.$self.trigger("pause")},g=function(){n.$playBtn.text(f.pause).attr("title",f.pauseTitle),n.$playBtn.addClass("acorn-paused-button")},y=function(){n.$playBtn.text(f.play).attr("title",f.playTitle),n.$playBtn.removeClass("acorn-paused-button")},b=function(){var e=n.$self.prop("currentTime");n.$timer.text(v(e)),i||(t.nativeSliders?n.$seek.attr("value",e):n.$seek.slider("value",e)),a&&F()},w=function(e){var t=Math.floor(e/60)<10?""+Math.floor(e/60):Math.floor(e/60),n=Math.floor(e-t*60)<10?""+Math.floor(e-t*60):Math.floor(e-t*60),r,i="minutes",s="seconds";return t==1&&(min="minute"),n==1&&(e="second"),t===0?r=n+" "+s:r=t+" "+i+" "+n+" "+s,r},E=function(){n.$captionBtn.trigger("blur")},S=function(e,r){n.$self.attr("paused")||(o=!0),n.$self.trigger("pause"),i=!0;var s;t.nativeSliders?s=n.$seek.val():s=r.value,n.$self[0].currentTime=s,E()},x=function(t,r){o&&(n.$self.trigger("play"),o=!1),i=!1;var s=e(r.handle);s.attr("aria-valuenow",parseInt(r.value,10)),s.attr("aria-valuetext",w(r.value))},T=function(e,t){var n={role:"slider","aria-valuenow":parseInt(t.value,10),"aria-valuemin":parseInt(t.min,10),"aria-valuemax":parseInt(t.max,10),"aria-valuetext":t.valuetext,tabindex:"0"};e.attr(n)},N=function(){var t=n.$seek.attr("class"),r='<div class="'+t+'" title="'+f.seekTitle+'"></div>';n.$seek.after(r).remove(),n.$seek=e("."+t,n.$container);var i='<div class="ui-slider-range acorn-buffer"></div>';n.$seek.append(i),n.$buffer=e(".acorn-buffer",n.$container);var s={value:0,step:1,orientation:"horizontal",range:"min",min:0,max:100};n.$seek.slider(s)},C=function(){var r=n.$self[0].duration;if(t.nativeSliders)n.$seek.attr("max",r),n.$seek.bind("change",S),n.$seek.bind("mousedown",S),n.$seek.bind("mouseup",x);else{var i={value:0,step:1,orientation:"horizontal",range:"min",min:0,max:r,slide:S,stop:x};n.$seek.slider("option",i),i.valuetext=w(i.value),T(n.$seek.find(".ui-slider-handle"),i),e(".ui-slider-handle",n.$seek).click(E),n.$self.bind("progress",k)}n.$self.next(".loading-media").remove(),m()},k=function(e){var t=parseInt(n.$self.prop("duration"),10),r=this.buffered;if(r&&r.length){var i=parseInt(this.buffered.end(0)-this.buffered.start(0),10),s=i*100/t;n.$buffer.css("width",s+"%")}},L=function(e,t){s=t.value,localStorage.setItem("acornvolume",s),n.$self.prop("muted")&&(n.$self.prop("muted",!1),n.$volumeBtn.removeClass("acorn-volume-mute"),n.$volumeBtn.text(f.mute).attr("title",f.mute)),n.$self.prop("volume",s),n.$volume.$handle.attr("aria-valuenow",Math.round(s*100)),n.$volume.$handle.attr("aria-valuetext",Math.round(s*100)+" percent"),E()},A=function(){n.$self.prop("muted")===!0?(n.$self.prop("muted",!1),t.nativeSliders?n.$volume.val(s):n.$volume.slider("value",s),n.$volumeBtn.removeClass("acorn-volume-mute"),n.$volumeBtn.text(f.mute).attr("title",f.mute)):(n.$self.prop("muted",!0),t.nativeSliders?n.$volume.val("0"):n.$volume.slider("value","0"),n.$volumeBtn.addClass("acorn-volume-mute"),n.$volumeBtn.text(f.unmute).attr("title",f.unmute))},O=function(){if(t.nativeSliders)n.$volume.bind("change",function(){n.$self.prop("muted",!1),s=n.$volume.val(),n.$self.prop("volume",s)});else{var r=n.$volume.attr("class"),i='<div class="'+r+'" title="'+f.volumeTitle+'"></div>';n.$volume.after(i).remove(),n.$volume=e("."+r,n.$container);var o={value:s,orientation:t.volumeSlider,range:"min",max:1,min:0,step:.1,animate:!0,slide:L};n.$volume.slider(o),n.$volume.$handle=n.$volume.find(".ui-slider-handle"),o.max=100,o.value=o.value*100,o.valuetext=o.value+" percent",T(n.$volume.$handle,o),e(".ui-slider-handle",n.$volume).click(E)}n.$volumeBtn.click(A)},M=function(){n.$self.attr({width:e(window).width(),height:e(window).height()})},_=function(){if(u){if(n.$self[0].webkitSupportsFullscreen)n.$self[0].webkitExitFullScreen();else{e("body").css("overflow","auto");var t=n.$self.attr("data-width"),r=n.$self.attr("data-height");n.$self.removeClass("fullscreen-video").attr({width:t,height:r}),e(window).unbind("resize"),n.$controls.removeClass("fullscreen-controls")}u=!1}else n.$self[0].webkitSupportsFullscreen?n.$self[0].webkitEnterFullScreen():(e("body").css("overflow","hidden"),n.$self.addClass("fullscreen-video").attr({width:e(window).width(),height:e(window).height()}),e(window).resize(M),n.$controls.addClass("fullscreen-controls")),u=!0},D="acorn-caption-active",P="acorn-caption-loading",H="acorn-transcript-active",B="acornCaptions"+r(),j=function(){captions="",n.$caption.hide(),activeCaptions=!1,n.$transcriptBtn.removeClass(H).hide(),n.$transcript.hide(),n.$captionBtn.removeClass(D)},F=function(){var e=n.$self[0].currentTime,t="";for(var r=0;r<captions.length;r++)if(e>=captions[r].start&&e<=captions[r].end){t=captions[r].content;break}n.$caption.html(t)},I=function(){var t=function(){var e=n.$captionBtn.offset(),t=e.top-n.$captionSelector.outerHeight(!0),r=e.left-(n.$captionSelector.outerWidth(!0)-n.$captionBtn.outerWidth(!0))/2,i=n.$controls.offset();r-=i.left,t-=i.top,n.$captionSelector.css({top:t,left:r})};n.$fullscreenBtn.click(t),e(window).resize(function(){t()}),t();var r,i=function(){r&&clearTimeout(r),n.$captionSelector.show()},s=function(){r=setTimeout(function(){n.$captionSelector.hide()},200)};n.$captionBtn.click(function(){e(this).focus()}),n.$captionBtn.bind("focus",i),n.$captionBtn.bind("blur",s),e("input[name="+B+"]",n.$container).bind("focus",i),e("input[name="+B+"]",n.$container).bind("blur",s),n.$captionSelector.attr("tabindex","-1"),n.$captionSelector.bind("focus",i),n.$captionSelector.bind("blur",s)},q=function(t){n.$captionBtn.addClass(P),e.ajax({url:t,success:function(t){captions=parseSrt(t),n.$transcriptBtn.show();var r="";e(captions).each(function(){r+='<span data-begin="'+parseInt(this.start,10)+'" data-end='+parseInt(this.end,10)+">"+this.content.replace("'","")+"</span>"}),n.$transcript.html(r),n.$caption.show(),a=!0,n.$self.prop("paused")&&F(),n.$captionBtn.addClass(D).removeClass(P)},error:function(){j(),console&&console.log("Error loading captions")}})},R=function(){e(this).hasClass(H)?n.$transcript.hide():n.$transcript.show(),e(this).toggleClass(H)},U=function(){n.$track=e("track",n.$self),n.$track.length&&n.$captionBtn.show();if(n.$track.length>1){n.$captionBtn.attr("title",f.captionsChoose);var r='<ul><li><label><input type="radio" name="'+B+'" checked="true" />None</label></li>';n.$track.each(function(){var t=e(this).attr("src");r+='<li><label><input type="radio" name="'+B+'" data-url="'+e(this).attr("src")+'" />'+e(this).attr("label")+"</label></li>"}),r+="</ul>",n.$captionSelector.html(r);var i=function(){var t=e(this).attr("data-url");t?q(t):j()};e("input[name="+B+"]",n.$container).change(i),I();var s=n.$track.first().attr("src");t.captionsOn&&(q(s),e("input[name="+B+"]",n.$container).removeAttr("checked"),e("input[name="+B+"]:eq(1)",n.$container).attr("checked","true"))}else if(n.$track.length){var o=n.$track.attr("src");n.$captionBtn.bind("click",function(){e(this).hasClass(D)?j():q(o),e(this).toggleClass(D)}),t.captionsOn&&q(o)}n.$transcriptBtn.bind("click",R)},z=function(){n.$playBtn.click(m),n.$self.click(m),n.$self.bind("play",g),n.$self.bind("pause",y),n.$self.bind("ended",y),n.$self.bind("timeupdate",b),n.$fullscreenBtn.click(_),O(),l.addClass(""),t.nativeSliders||N(),n.$self.bind("loadedmetadata",function(){var e=window.setInterval(function(){n.$self[0].readyState>0&&(C(),clearInterval(e))},500);U()}),n.$self.removeAttr("controls"),n.$self.is("audio")&&n.$container.addClass("audio-player")}()};return this.each(o)}})(jQuery);